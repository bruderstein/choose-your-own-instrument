<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="styles.css">
    <script src="tones.js"></script>
    <script>

      function addShape (shape, note, octave, listenerType) {
        var element = document.createElement("div");
        element.playTone = function (e) { tones.play(note, octave) };
        element.className = "shape " + shape;
        element.addEventListener(listenerType, element.playTone);
        document.body.appendChild(element);
      }

      function playOneElement (element, delay, i) {
        function play () {
          element.className = element.className.replace("shape", "auto-playing shape");
          element.playTone();
          setTimeout(function () {
            element.className = element.className.replace("auto-playing shape", "shape");
          }, delay);
        }

        setTimeout(play, delay * i);
      }

      function playAllAgain (delay, numberOfShapes) {
        function loop () {
          autoPlayAll(delay);
        }

        setTimeout(loop, delay * numberOfShapes);
      }

      function autoPlayAll (delay) {
        var shapes = document.querySelectorAll('.shape');
        for (var i = 0; i < shapes.length; i++) {
          playOneElement(shapes[i], delay, i);
        }
        playAllAgain(delay, shapes.length);
      }

      function clearAllTimeouts () {
        var nextTimeout = setTimeout(function(){}, 0);
        for (var i = 1; i < nextTimeout; i++) {
          clearTimeout(i);
        }
      }

      function resetShapeClassNames () {
        var shapes = document.querySelectorAll('.shape');
        for (var j = 0; j < shapes.length; j++) {
          shapes[j].className = shapes[j].className.replace("auto-playing ", "");
        }
      }

      document.addEventListener("keydown", function (e) {
        if (e.code === "Space") {
          autoPlayAll(500);
        }

        if (e.code === "Escape") {
          clearAllTimeouts();
          resetShapeClassNames();
        }
      });

    </script>
    <title>Choose Your Own Instrument</title>
  </head>
  <body>
  </body>
  <script>

    // background: "sky", "sea", "bubble-gum", "fireball", "sunset", "fuji"
    // shapes: "triangle", "circle", "square"

    document.querySelector("body").className = "sky";

    var circle = document.createElement("div");
    circle.playTone = function (e) { tones.play("c", 4) };
    circle.className = "shape circle";
    circle.addEventListener("mouseover", circle.playTone);
    document.body.appendChild(circle);

    var triangle = document.createElement("div");
    triangle.playTone = function (e) { tones.play("d", 4) };
    triangle.className = "shape triangle";
    triangle.addEventListener("mouseover", triangle.playTone);
    document.body.appendChild(triangle);

    var square = document.createElement("div");
    square.playTone = function (e) { tones.play("e", 4) };
    square.className = "shape square";
    square.addEventListener("mouseover", square.playTone);
    document.body.appendChild(square);

  </script>
</html>
